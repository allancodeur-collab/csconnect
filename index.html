<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <title>CIS Connect</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@500;600;700&family=Nunito:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
<div id="app">

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LOGIN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="loginScreen" class="screen active">
    <div class="login-logo">ğŸ”¥</div>
    <div class="login-title">CIS CONNECT</div>
    <div class="login-subtitle">SDIS 31</div>
    <div class="login-card">
      <div class="input-group">
        <label>Adresse Email</label>
        <input type="email" id="loginEmail" placeholder="votre@email.fr" value="pierre.dubois@sdis.fr">
      </div>
      <div class="input-group">
        <label>Mot de passe</label>
        <input type="password" id="loginPass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" value="password">
      </div>
      <button class="btn-primary" onclick="doLogin()">CONNEXION</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DASHBOARD
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="dashScreen" class="screen">
    <div class="topbar">
      <div class="topbar-left">
        <div class="topbar-logo">ğŸš’</div>
        <div class="topbar-title">CIS AUTERIVE</div>
      </div>
      <div class="topbar-right">
        <button class="notif-btn" onclick="toggleNotifs()">
          ğŸ””<div class="notif-badge" id="notifCount">3</div>
        </button>
        <button class="avatar-sm" onclick="showScreen('profilScreen')">ğŸ‘¤</button>
      </div>
    </div>

    <div class="dash-hero">
      <div class="dash-cis-name">Caporal Dubois</div>
      <div class="dash-stats">
        <div class="stat-card red">
          <div class="stat-value">1287</div>
          <div class="stat-label">ğŸš¨ Interventions totales</div>
        </div>
        <div class="stat-card">
          <div class="stat-sub">ğŸ“… Aujourd'hui</div>
          <div class="stat-med" id="dateToday"></div>
          <div class="stat-sub" style="margin-top:6px">ğŸ¥ Visite mÃ©dicale</div>
          <div class="stat-med-sub">16/08/2025</div>
        </div>
      </div>
    </div>

    <div class="dash-content dash-pad">
      <div class="section-title">Modules principaux</div>
      <div class="menu-grid">
        <button class="menu-btn" onclick="showScreen('actuScreen')">
          <div class="icon">ğŸ“°</div>
          <div class="label">ActualitÃ©s</div>
          <div class="sublabel">3 nouvelles</div>
        </button>
        <button class="menu-btn orange" onclick="showScreen('fdfScreen')">
          <div class="icon">ğŸŒ²</div>
          <div class="label">Dispo FDF</div>
          <div class="sublabel">Feux de forÃªt</div>
        </button>
        <button class="menu-btn green" onclick="showScreen('invScreen')">
          <div class="icon">ğŸ“‹</div>
          <div class="label">Inventaires</div>
          <div class="sublabel">9 vÃ©hicules</div>
        </button>
        <button class="menu-btn blue" onclick="showScreen('vehicScreen')">
          <div class="icon">ğŸš’</div>
          <div class="label">VÃ©hicules</div>
          <div class="sublabel">1 problÃ¨me</div>
        </button>
      </div>

      <div class="section-title">Autres modules</div>

      <button class="menu-btn-full" onclick="showScreen('infosScreen')">
        <div class="menu-btn-full-left">
          <div class="menu-btn-full-icon bg-purple">ğŸ“</div>
          <div class="menu-btn-full-text">
            <div class="title">Infos Internes</div>
            <div class="sub">Notes & procÃ©dures</div>
          </div>
        </div>
        <div class="chevron">â€º</div>
      </button>

      <button class="menu-btn-full" onclick="showScreen('annuaireScreen')">
        <div class="menu-btn-full-left">
          <div class="menu-btn-full-icon bg-blue">ğŸ“’</div>
          <div class="menu-btn-full-text">
            <div class="title">Annuaire CS</div>
            <div class="sub">CoordonnÃ©es Ã©quipe</div>
          </div>
        </div>
        <div class="chevron">â€º</div>
      </button>

      <button class="menu-btn-full" onclick="showScreen('formationScreen')">
        <div class="menu-btn-full-left">
          <div class="menu-btn-full-icon bg-green">ğŸ“</div>
          <div class="menu-btn-full-text">
            <div class="title">Formations</div>
            <div class="sub">Suivi FMPA</div>
          </div>
        </div>
        <div class="chevron">â€º</div>
      </button>

      <button class="menu-btn-full" onclick="showScreen('gardeScreen')">
        <div class="menu-btn-full-left">
          <div class="menu-btn-full-icon bg-orange">ğŸ›¡ï¸</div>
          <div class="menu-btn-full-text">
            <div class="title">Ã‰quipe de Garde 1</div>
            <div class="sub">Communication interne</div>
          </div>
        </div>
        <div class="chevron">â€º</div>
      </button>

      <button class="menu-btn-full" onclick="showScreen('adminScreen')">
        <div class="menu-btn-full-left">
          <div class="menu-btn-full-icon bg-red">âš™ï¸</div>
          <div class="menu-btn-full-text">
            <div class="title">Administrateur</div>
            <div class="sub">Gestion & configuration</div>
          </div>
        </div>
        <div class="chevron">â€º</div>
      </button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ACTUALITÃ‰S
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="actuScreen" class="screen">
    <div class="sub-header">
      <button class="back-btn" onclick="showScreen('dashScreen')">â†</button>
      <div class="sub-header-title">ğŸ“° ActualitÃ©s</div>
      <button class="notif-btn" style="margin-left:auto" onclick="toggleNotifs()">
        ğŸ””<div class="notif-badge">3</div>
      </button>
    </div>
    <div class="sub-content" id="actuList" style="padding-bottom:90px"></div>
    <button class="fab" onclick="openPublishModal()">âœï¸</button>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FDF â€“ DISPONIBILITÃ‰S
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="fdfScreen" class="screen">
    <div class="sub-header">
      <button class="back-btn" onclick="showScreen('dashScreen')">â†</button>
      <div class="sub-header-title">ğŸŒ² DisponibilitÃ©s FDF</div>
    </div>
    <div class="sub-content" style="padding-bottom:30px">
      <div style="font-weight:700;font-size:16px;margin-bottom:14px">Bonjour Pierre ! ğŸ‘‹</div>

      <!-- Vue SPV -->
      <div id="fdfMyView">
        <div style="font-size:12px;color:var(--text2);margin-bottom:10px">
          Touchez un jour pour basculer votre dispo. Utilisez les boutons rapides pour toute la semaine.
        </div>
        <div class="fdf-week-nav">
          <button class="week-arrow" onclick="fdfChangeWeek(-1)">â€¹</button>
          <span class="week-label" id="fdfWeekLabel">â€”</span>
          <button class="week-arrow" onclick="fdfChangeWeek(1)">â€º</button>
        </div>
        <div style="display:flex;gap:8px;margin-bottom:12px">
          <button onclick="fdfSetWeek(true)"  style="flex:1;background:rgba(39,174,96,0.15);border:1px solid rgba(39,174,96,0.3);border-radius:10px;padding:9px;color:var(--green);font-weight:700;font-size:13px;">âœ“ Toute la semaine</button>
          <button onclick="fdfSetWeek(false)" style="flex:1;background:rgba(192,39,45,0.1);border:1px solid rgba(192,39,45,0.2);border-radius:10px;padding:9px;color:var(--red-light);font-weight:700;font-size:13px;">âœ— Toute la semaine</button>
        </div>
        <div class="fdf-grid-header">
          <div></div>
          <div class="fdf-day-label">Lun</div>
          <div class="fdf-day-label">Mar</div>
          <div class="fdf-day-label">Mer</div>
          <div class="fdf-day-label">Jeu</div>
          <div class="fdf-day-label">Ven</div>
          <div class="fdf-day-label">Sam</div>
          <div class="fdf-day-label">Dim</div>
        </div>
        <div id="fdfMyRow" class="fdf-row"></div>
        <div id="fdfStatusBadge" style="text-align:center;margin:10px 0 4px;font-size:12px;color:var(--text2)">0/7 jours renseignÃ©s</div>
        <button class="btn-valider" onclick="fdfSaveMyDispos()">ğŸ’¾ ENREGISTRER MES DISPONIBILITÃ‰S</button>
      </div>

      <!-- Vue Responsable FDF -->
      <div id="fdfRespoView" style="display:none">
        <div class="fdf-week-nav">
          <button class="week-arrow" onclick="fdfChangeWeek(-1)">â€¹</button>
          <span class="week-label" id="fdfWeekLabel2">â€”</span>
          <button class="week-arrow" onclick="fdfChangeWeek(1)">â€º</button>
        </div>
        <div id="fdfAllRows"></div>
        <div class="fdf-summary">
          <div class="fdf-count green">
            <div class="fdf-count-value" id="fdfCountDispo">0</div>
            <div class="fdf-count-label">ValidÃ©s</div>
          </div>
          <div class="fdf-divider"></div>
          <div class="fdf-count red">
            <div class="fdf-count-value" id="fdfCountIndispo">0</div>
            <div class="fdf-count-label">RefusÃ©s</div>
          </div>
          <div class="fdf-divider"></div>
          <div class="fdf-count">
            <div class="fdf-count-value" id="fdfCountPending" style="color:var(--orange)">0</div>
            <div class="fdf-count-label">En attente</div>
          </div>
        </div>
        <button class="btn-valider" onclick="fdfValiderTous()">âœ… VALIDER TOUS EN ATTENTE</button>
      </div>

      <!-- SÃ©lecteur de vue (dÃ©mo rÃ´les) -->
      <div style="margin-top:20px;padding:12px;background:rgba(255,255,255,0.04);border:1px solid var(--border);border-radius:12px">
        <div style="font-size:11px;color:var(--text2);margin-bottom:8px;text-transform:uppercase;letter-spacing:1px;font-weight:700">Changer de vue (dÃ©monstration rÃ´les)</div>
        <div style="display:flex;gap:8px">
          <button id="fdfBtnMy"    onclick="fdfShowView('my')"    style="flex:1;background:var(--red);border:none;border-radius:8px;padding:8px;color:white;font-weight:700;font-size:12px;">Ma vue SPV</button>
          <button id="fdfBtnRespo" onclick="fdfShowView('respo')" style="flex:1;background:var(--gray);border:1px solid var(--border);border-radius:8px;padding:8px;color:var(--text);font-weight:700;font-size:12px;">Vue Responsable FDF</button>
        </div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       INVENTAIRES
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="invScreen" class="screen">
    <div class="sub-header">
      <button class="back-btn" onclick="showScreen('dashScreen')">â†</button>
      <div class="sub-header-title">ğŸ“‹ Inventaires</div>
    </div>
    <div class="sub-content">
      <div class="protocol-card">
        <div class="protocol-title">ğŸ©º Suivi Protocole 3 VSAV</div>
        <div class="protocol-row">
          <button class="protocol-btn" onclick="showToast('âœ… Protocole VSAV 1 validÃ© - ' + new Date().toLocaleDateString('fr-FR'))">
            <div class="vehicle">VSAV 1</div>
            <div class="last">Dernier : 15/04/2025</div>
            <div class="last" style="color:var(--green)">Sgt. Martin</div>
          </button>
          <button class="protocol-btn" onclick="showToast('âœ… Protocole VSAV 2 validÃ© - ' + new Date().toLocaleDateString('fr-FR'))">
            <div class="vehicle">VSAV 2</div>
            <div class="last">Dernier : 13/04/2025</div>
            <div class="last" style="color:var(--green)">Cpl. Dubois</div>
          </button>
        </div>
      </div>
      <div class="section-title">VÃ©hicules</div>
      <div id="vehicleList"></div>
      <div class="spacer-md"></div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       VÃ‰HICULES
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="vehicScreen" class="screen">
    <div class="sub-header">
      <button class="back-btn" onclick="showScreen('dashScreen')">â†</button>
      <div class="sub-header-title">ğŸš’ VÃ©hicules</div>
    </div>
    <div class="sub-content">
      <div class="section-title">Synoptique DisponibilitÃ©</div>
      <div id="vehicSynoptic"></div>

      <div class="section-title" style="margin-top:20px">ProblÃ¨mes signalÃ©s</div>
      <div class="problem-card">
        <div class="problem-left"><div>
          <div class="problem-vehicle">FPT</div>
          <div class="problem-desc">DÃ©faut Radio</div>
          <div class="problem-date">13/04/2025 â€¢ SignalÃ© par Cpl. Dubois</div>
        </div></div>
        <div class="problem-status status-open">En cours</div>
      </div>
      <div class="problem-card">
        <div class="problem-left"><div>
          <div class="problem-vehicle">FPT</div>
          <div class="problem-desc">Fuite d'eau</div>
          <div class="problem-date">11/04/2025 â€¢ SignalÃ© par Sgt. Lefebvre</div>
        </div></div>
        <div class="problem-status status-resolved">RÃ©parÃ©</div>
      </div>
      <div class="problem-card">
        <div class="problem-left"><div>
          <div class="problem-vehicle">VSR</div>
          <div class="problem-desc">Imoni Adjoint</div>
          <div class="problem-date">09/04/2025 â€¢ SignalÃ© par Cpl. Moreau</div>
        </div></div>
        <div class="problem-status status-resolved">RÃ©parÃ©</div>
      </div>
      <button class="btn-inline" onclick="openProblemModal()">â• Signaler un problÃ¨me</button>
      <div class="spacer-md"></div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       INFOS INTERNES
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="infosScreen" class="screen">
    <div class="sub-header">
      <button class="back-btn" onclick="showScreen('dashScreen')">â†</button>
      <div class="sub-header-title">ğŸ“ Infos Internes</div>
    </div>
    <div class="sub-content">
      <div class="cat-scroll">
        <button class="cat-btn active" onclick="filterCat(this,'Tout')">Tout</button>
        <button class="cat-btn" onclick="filterCat(this,'Note de service')">Notes de service</button>
        <button class="cat-btn" onclick="filterCat(this,'Note interne')">Notes internes</button>
        <button class="cat-btn" onclick="filterCat(this,'ProcÃ©dure')">ProcÃ©dures</button>
      </div>
      <div class="doc-card" onclick="showToast('ğŸ“‹ Ouverture du document...')">
        <div class="doc-card-header">
          <div class="doc-icon">ğŸ“‹</div>
          <div><div class="doc-title">ProcÃ©dure Extraction AVP</div><div class="doc-cat">ProcÃ©dure</div></div>
          <div class="doc-date">12/04/2025</div>
        </div>
      </div>
      <div class="doc-card" onclick="showToast('ğŸ“ Ouverture du document...')">
        <div class="doc-card-header">
          <div class="doc-icon">ğŸ“</div>
          <div><div class="doc-title">Note de service NÂ°12/2025</div><div class="doc-cat">Note de service</div></div>
          <div class="doc-date">10/04/2025</div>
        </div>
      </div>
      <div class="doc-card" onclick="showToast('ğŸ”’ Ouverture du document...')">
        <div class="doc-card-header">
          <div class="doc-icon">ğŸ”’</div>
          <div><div class="doc-title">Note interne â€“ Astreinte Chef</div><div class="doc-cat">Note interne</div></div>
          <div class="doc-date">08/04/2025</div>
        </div>
      </div>
      <div class="doc-card" onclick="showToast('ğŸ“‹ Ouverture du document...')">
        <div class="doc-card-header">
          <div class="doc-icon">ğŸ“‹</div>
          <div><div class="doc-title">ProcÃ©dure VSAV â€“ Protocole 3</div><div class="doc-cat">ProcÃ©dure</div></div>
          <div class="doc-date">01/04/2025</div>
        </div>
      </div>
      <button class="btn-inline" onclick="showToast('ğŸ“¤ Formulaire de publication')">ğŸ“¤ Publier un document</button>
      <div class="spacer-md"></div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ANNUAIRE
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="annuaireScreen" class="screen">
    <div class="sub-header">
      <button class="back-btn" onclick="showScreen('dashScreen')">â†</button>
      <div class="sub-header-title">ğŸ“’ Annuaire CS</div>
    </div>
    <div class="sub-content">
      <div class="search-bar">
        <span>ğŸ”</span>
        <input type="text" placeholder="Rechercher un pompier..." oninput="filterAnnuaire(this.value)">
      </div>
      <div id="annuaireList"></div>
      <div class="spacer-md"></div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FORMATIONS
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="formationScreen" class="screen">
    <div class="sub-header">
      <button class="back-btn" onclick="showScreen('dashScreen')">â†</button>
      <div class="sub-header-title">ğŸ“ Formations</div>
    </div>
    <div class="sub-content">
      <div id="formationList"></div>
      <button class="btn-inline" onclick="openFormationModal()">â• Nouvelle Ã©valuation</button>
      <div class="spacer-md"></div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       GARDE â€“ CHAT
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="gardeScreen" class="screen">
    <div class="sub-header">
      <button class="back-btn" onclick="showScreen('dashScreen')">â†</button>
      <div class="sub-header-title">ğŸ›¡ï¸ Garde 1</div>
    </div>
    <div style="padding:16px 18px;border-bottom:1px solid var(--border);background:rgba(192,39,45,0.05)">
      <div style="font-size:13px;color:var(--text2)">Prochaine manÅ“uvre</div>
      <div style="font-weight:700;font-size:16px">Samedi 26 Avril â€“ 14h00</div>
      <div style="font-size:12px;color:var(--text2);margin-top:4px">Sport : Lt. Martin â€¢ Repas : Adjt. Roux</div>
    </div>
    <div class="sub-content garde-chat" id="gardeChat" style="padding-bottom:80px">
      <div class="chat-msg received">
        <div class="chat-msg-author">Lt. Martin (Chef de Garde)</div>
        Bonjour la garde ! ManÅ“uvre samedi 9h, tout le monde dispo ?
        <div class="chat-time">08:32</div>
      </div>
      <div class="chat-msg sent">
        PrÃ©sent ! Je m'occupe du sport.
        <div class="chat-time">08:45</div>
      </div>
      <div class="chat-msg received">
        <div class="chat-msg-author">Sgt. Lefebvre</div>
        Je serai lÃ , je prends le repas en charge ğŸ³
        <div class="chat-time">09:01</div>
      </div>
      <div class="chat-msg received">
        <div class="chat-msg-author">Lt. Martin (Chef de Garde)</div>
        Parfait ! Rappel : tenues de sortie pour la manÅ“uvre.
        <div class="chat-time">09:15</div>
      </div>
    </div>
    <div class="chat-input-bar">
      <input class="chat-input" id="chatInput" type="text" placeholder="Message Ã  la garde...">
      <button class="chat-send" onclick="sendGardeMsg()">â¤</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       PROFIL
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="profilScreen" class="screen">
    <div class="topbar">
      <button class="back-btn" onclick="showScreen('dashScreen')">â†</button>
      <div class="topbar-title">Mon Profil</div>
      <div style="width:34px"></div>
    </div>
    <div style="overflow-y:auto;flex:1">
      <div class="profil-hero">
        <div class="profil-avatar-wrap">
          <div class="profil-avatar">ğŸ‘¨â€ğŸš’</div>
          <button class="profil-edit-btn" onclick="showToast('ğŸ“· Modifier photo de profil')">âœï¸</button>
        </div>
        <div class="profil-name">Pierre Dubois</div>
        <div class="profil-grade">Caporal â€¢ Sapeur-Pompier Volontaire</div>
        <div class="profil-role-badge">SPV â€“ Garde 1</div>
      </div>
      <div class="profil-section">
        <div class="profil-info-card">
          <div class="profil-info-row">
            <div class="profil-info-icon">âœ‰ï¸</div>
            <div><div class="profil-info-label">Email</div><div class="profil-info-value">p.dubois@sdis.fr</div></div>
          </div>
          <div class="profil-info-row">
            <div class="profil-info-icon">ğŸ“±</div>
            <div><div class="profil-info-label">TÃ©lÃ©phone</div><div class="profil-info-value">06 12 33 56 78</div></div>
          </div>
          <div class="profil-info-row">
            <div class="profil-info-icon">ğŸ–ï¸</div>
            <div><div class="profil-info-label">Grade</div><div class="profil-info-value">Caporal</div></div>
          </div>
          <div class="profil-info-row">
            <div class="profil-info-icon">ğŸ”‘</div>
            <div><div class="profil-info-label">Fonction</div><div class="profil-info-value">EQ</div></div>
          </div>
          <div class="profil-info-row">
            <div class="profil-info-icon">ğŸ¥</div>
            <div>
              <div class="profil-info-label">Visite mÃ©dicale prÃ©vue</div>
              <div class="profil-info-value" style="color:var(--orange)">16/08/2025</div>
            </div>
          </div>
        </div>

        <div class="section-title">ParamÃ¨tres de notifications</div>
        <div class="profil-info-card">
          <div class="toggle-row">
            <div class="toggle-label">ğŸ”” Notifications globales</div>
            <div class="toggle" onclick="this.classList.toggle('off')"></div>
          </div>
          <div class="toggle-row">
            <div class="toggle-label">ğŸš¨ Alertes urgentes</div>
            <div class="toggle" onclick="this.classList.toggle('off')"></div>
          </div>
          <div class="toggle-row">
            <div class="toggle-label">ğŸš’ ProblÃ¨mes vÃ©hicules</div>
            <div class="toggle" onclick="this.classList.toggle('off')"></div>
          </div>
        </div>
        <button class="btn-logout" onclick="doLogout()">ğŸšª DÃ‰CONNEXION</button>
        <div class="spacer-sm"></div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ADMIN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="adminScreen" class="screen">
    <div class="sub-header">
      <button class="back-btn" onclick="showScreen('dashScreen')">â†</button>
      <div class="sub-header-title">âš™ï¸ Administrateur</div>
    </div>
    <div class="sub-content">
      <div class="admin-section">
        <div class="admin-section-title">ğŸš¨ Interventions totales</div>
        <input class="admin-input" type="number" id="interventionCount" value="1287">
        <button class="btn-secondary" onclick="showToast('âœ… Mis Ã  jour !')">Mettre Ã  jour</button>
      </div>
      <div class="admin-section" style="cursor:pointer" onclick="showScreen('userMgmtScreen')">
        <div class="admin-section-title">ğŸ‘¥ Gestion des utilisateurs</div>
        <div style="display:flex;align-items:center;justify-content:space-between">
          <div style="color:var(--text2);font-size:14px">GÃ©rer les comptes, rÃ´les et profils</div>
          <div style="display:flex;align-items:center;gap:8px">
            <span id="adminUserCount" style="background:var(--red);color:white;padding:2px 10px;border-radius:10px;font-size:13px;font-weight:800">8</span>
            <span style="color:var(--red-light);font-size:20px">â€º</span>
          </div>
        </div>
      </div>
      <div class="admin-section">
        <div class="admin-section-title">ğŸš’ VÃ©hicules</div>
        <input class="admin-input" type="text" placeholder="Nom du nouveau vÃ©hicule (ex: VPI)">
        <button class="btn-secondary" onclick="showToast('âœ… VÃ©hicule ajoutÃ© !')">Ajouter</button>
      </div>
      <div class="admin-section">
        <div class="admin-section-title">ğŸ“§ Email suivi formations</div>
        <input class="admin-input" type="email" value="formation@sdis31.fr">
        <button class="btn-secondary" onclick="showToast('âœ… Email mis Ã  jour !')">Enregistrer</button>
      </div>
      <div class="spacer-md"></div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       USER MANAGEMENT
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="userMgmtScreen" class="screen">
    <div class="topbar">
      <button class="back-btn" onclick="showScreen('adminScreen')">â†</button>
      <div class="topbar-title">ğŸ‘¥ Utilisateurs <span class="user-count-badge" id="userCountBadge">8</span></div>
      <button class="btn-secondary" style="padding:7px 14px;font-size:13px" onclick="openUserEdit(null)">â• Ajouter</button>
    </div>
    <div style="padding:16px 18px;padding-bottom:60px;overflow-y:auto;flex:1">
      <div class="search-bar" style="margin-bottom:12px">
        <span>ğŸ”</span>
        <input type="text" placeholder="Rechercher..." oninput="filterUsers(this.value)" id="userSearch">
      </div>
      <div class="filter-bar">
        <button class="filter-pill active" onclick="setRoleFilter(this,'Tous')">Tous</button>
        <button class="filter-pill" onclick="setRoleFilter(this,'SPV')">SPV</button>
        <button class="filter-pill" onclick="setRoleFilter(this,'Chef de Garde')">Chef de Garde</button>
        <button class="filter-pill" onclick="setRoleFilter(this,'Formateur')">Formateur</button>
        <button class="filter-pill" onclick="setRoleFilter(this,'MÃ©canicien')">MÃ©canicien</button>
        <button class="filter-pill" onclick="setRoleFilter(this,'Admin')">Admin</button>
      </div>
      <div id="userCardList"></div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       NOTIFICATIONS PANEL
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="notifPanel">
    <div class="notif-overlay" onclick="toggleNotifs()"></div>
    <div class="notif-drawer">
      <div class="notif-header">
        <div class="notif-header-title">ğŸ”” Notifications</div>
        <button style="background:none;border:none;color:white;font-size:18px" onclick="toggleNotifs()">âœ•</button>
      </div>
      <div class="notif-item unread" onclick="markRead(this)">
        <div class="notif-item-header">
          <span class="notif-sender">Lt. Martin <span class="notif-dot"></span></span>
          <span class="notif-time">il y a 10 min</span>
        </div>
        <div class="notif-msg">Nouvelle publication : Formation Sauvetage Ã  la corde â€“ Samedi 23 Avril 2025</div>
      </div>
      <div class="notif-item unread" onclick="markRead(this)">
        <div class="notif-item-header">
          <span class="notif-sender">Adjt. Dupont <span class="notif-dot"></span></span>
          <span class="notif-time">il y a 2h</span>
        </div>
        <div class="notif-msg">âš ï¸ ALERTE URGENTE : Orages violents prÃ©vus ce soir. Restez joignables.</div>
      </div>
      <div class="notif-item unread" onclick="markRead(this)">
        <div class="notif-item-header">
          <span class="notif-sender">MÃ©canicien Roux <span class="notif-dot"></span></span>
          <span class="notif-time">il y a 3h</span>
        </div>
        <div class="notif-msg">ğŸš’ FPT indisponible â€“ ProblÃ¨me radio en cours de traitement.</div>
      </div>
      <div class="notif-item" onclick="markRead(this)">
        <div class="notif-item-header">
          <span class="notif-sender">Responsable FDF</span>
          <span class="notif-time">Hier</span>
        </div>
        <div class="notif-msg">âœ… Votre disponibilitÃ© FDF semaine 16 a Ã©tÃ© validÃ©e.</div>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MODAL â€“ PUBLIER
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="modal-overlay" id="publishModal">
    <div class="modal-sheet" onclick="event.stopPropagation()">
      <div class="modal-handle"></div>
      <div class="modal-title">âœï¸ Nouvelle publication</div>
      <select class="select-input" id="pubType">
        <option value="event">ğŸ“… Ã‰vÃ©nement</option>
        <option value="formation">ğŸ“ Formation</option>
        <option value="alert">âš ï¸ Alerte urgente</option>
      </select>
      <input class="admin-input" type="text" id="pubTitle" placeholder="Titre de la publication">
      <textarea class="admin-input" id="pubBody" placeholder="Contenu du message..." style="min-height:90px;resize:vertical"></textarea>
      <label style="display:flex;align-items:center;gap:8px;cursor:pointer;font-size:13px;color:var(--text2);margin-bottom:10px">
        <input type="checkbox" id="pubHasFile" onchange="document.getElementById('pubFileName').style.display=this.checked?'block':'none'" style="accent-color:var(--red);width:16px;height:16px">
        Ajouter une piÃ¨ce jointe
      </label>
      <input class="admin-input" type="text" id="pubFileName" placeholder="Nom du fichier (ex: Document.pdf)" style="display:none">
      <button class="btn-primary" onclick="publishActu()">ğŸ“¢ PUBLIER ET NOTIFIER TOUS</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MODAL â€“ SIGNALER UN PROBLÃˆME
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="modal-overlay" id="problemModal">
    <div class="modal-sheet" onclick="event.stopPropagation()">
      <div class="modal-handle"></div>
      <div class="modal-title">ğŸš¨ Signaler un problÃ¨me</div>
      <select class="select-input" id="problemVehicle">
        <option>VSAV 1</option><option>VSAV 2</option><option>FPT</option>
        <option>EPA</option><option>VSR</option><option>CCF</option>
        <option>VTUTP</option><option>VTP</option><option>VLTC</option>
      </select>
      <input class="admin-input" type="text" id="problemDesc" placeholder="Description du problÃ¨me">
      <textarea class="admin-input" placeholder="DÃ©tails supplÃ©mentaires..."></textarea>
      <button class="btn-primary" onclick="submitProblem()">SIGNALER</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MODAL â€“ FORMATION
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="modal-overlay" id="formationModal">
    <div class="modal-sheet" onclick="event.stopPropagation()">
      <div class="modal-handle"></div>
      <div class="modal-title">ğŸ“‹ Nouvelle Ã©valuation</div>
      <select class="select-input" id="formPersonnel">
        <option>Dubois Pierre</option><option>Martin Sophie</option>
        <option>Lefebvre Tom</option><option>Moreau Julie</option>
      </select>
      <select class="select-input" id="formType">
        <option value="suap">ManÅ“uvre : SUAP</option>
        <option value="inc">ManÅ“uvre : INC</option>
        <option value="div">ManÅ“uvre : DIV</option>
      </select>
      <input class="admin-input" type="date" id="formDate">
      <select class="select-input" id="formFonction">
        <option>EQ</option><option>CA1E</option><option>CATE</option><option>CDG</option>
      </select>
      <textarea class="admin-input" id="formPositif" placeholder="âœ… Points positifs..."></textarea>
      <textarea class="admin-input" id="formAmelio"  placeholder="ğŸ”§ Axes d'amÃ©lioration..."></textarea>
      <select class="select-input" id="formFormateur">
        <option>Lt. Roux</option><option>Cne. Durand</option>
      </select>
      <button class="btn-primary" onclick="submitFormation()">ENREGISTRER</button>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MODAL â€“ Ã‰DITION UTILISATEUR (full screen)
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="modal-full" id="editUserModal">
    <div class="modal-full-header">
      <button class="back-btn" onclick="closeUserEdit()">â†</button>
      <div class="modal-full-title" id="editModalTitle">Modifier</div>
    </div>
    <div class="modal-full-body">

      <!-- AperÃ§u avatar -->
      <div style="display:flex;justify-content:center;margin-bottom:24px">
        <div id="editAvatarPreview" style="width:80px;height:80px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:34px;color:white;border:3px solid rgba(255,255,255,0.2);position:relative;background:#C0272D">
          <span id="editAvatarEmoji">ğŸ‘¤</span>
          <div style="position:absolute;bottom:0;right:0;width:26px;height:26px;border-radius:50%;background:var(--red);display:flex;align-items:center;justify-content:center;font-size:12px">âœï¸</div>
        </div>
      </div>

      <!-- Emoji picker -->
      <div class="form-group">
        <label class="form-label">Emoji avatar</label>
        <div class="avatar-picker" id="avatarPicker">
          <div class="avatar-opt selected" data-emoji="ğŸ‘¤"  onclick="selectAvatar(this)" style="background:#555">ğŸ‘¤</div>
          <div class="avatar-opt" data-emoji="ğŸ‘¨â€ğŸš’" onclick="selectAvatar(this)" style="background:#8B1A1E">ğŸ‘¨â€ğŸš’</div>
          <div class="avatar-opt" data-emoji="ğŸ‘©â€ğŸš’" onclick="selectAvatar(this)" style="background:#8B1A1E">ğŸ‘©â€ğŸš’</div>
          <div class="avatar-opt" data-emoji="ğŸ§‘â€ğŸš’" onclick="selectAvatar(this)" style="background:#8B1A1E">ğŸ§‘â€ğŸš’</div>
          <div class="avatar-opt" data-emoji="ğŸ‘®"  onclick="selectAvatar(this)" style="background:#0F3460">ğŸ‘®</div>
          <div class="avatar-opt" data-emoji="â­"  onclick="selectAvatar(this)" style="background:#2C7A3A">â­</div>
          <div class="avatar-opt" data-emoji="ğŸ–ï¸" onclick="selectAvatar(this)" style="background:#7D5A00">ğŸ–ï¸</div>
          <div class="avatar-opt" data-emoji="ğŸ”§"  onclick="selectAvatar(this)" style="background:#333">ğŸ”§</div>
        </div>
      </div>

      <!-- Color picker -->
      <div class="form-group">
        <label class="form-label">Couleur avatar</label>
        <div class="color-picker" id="colorPicker">
          <div class="color-opt selected" data-color="#C0272D" onclick="selectColor(this)" style="background:#C0272D"></div>
          <div class="color-opt" data-color="#8B1A1E" onclick="selectColor(this)" style="background:#8B1A1E"></div>
          <div class="color-opt" data-color="#0F3460" onclick="selectColor(this)" style="background:#0F3460"></div>
          <div class="color-opt" data-color="#27AE60" onclick="selectColor(this)" style="background:#27AE60"></div>
          <div class="color-opt" data-color="#E67E22" onclick="selectColor(this)" style="background:#E67E22"></div>
          <div class="color-opt" data-color="#9B59B6" onclick="selectColor(this)" style="background:#9B59B6"></div>
          <div class="color-opt" data-color="#2980B9" onclick="selectColor(this)" style="background:#2980B9"></div>
          <div class="color-opt" data-color="#555"    onclick="selectColor(this)" style="background:#555"></div>
        </div>
      </div>

      <!-- Nom / PrÃ©nom -->
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="form-group">
          <label class="form-label">PrÃ©nom</label>
          <input class="form-input" type="text" id="editPrenom" placeholder="Pierre">
        </div>
        <div class="form-group">
          <label class="form-label">Nom</label>
          <input class="form-input" type="text" id="editNom" placeholder="Dubois">
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Email</label>
        <input class="form-input" type="email" id="editEmail" placeholder="p.dubois@sdis.fr">
      </div>
      <div class="form-group">
        <label class="form-label">TÃ©lÃ©phone</label>
        <input class="form-input" type="tel" id="editTel" placeholder="06 12 34 56 78">
      </div>
      <div class="form-group">
        <label class="form-label">Grade</label>
        <select class="form-input" id="editGrade">
          <option>Sapeur</option><option>Caporal</option><option>Sergent</option>
          <option>Sergent Chef</option><option>Adjudant</option><option>Adjudant Chef</option>
          <option>Lieutenant</option><option>Capitaine</option>
        </select>
      </div>
      <div class="form-group">
        <label class="form-label">Fonction</label>
        <select class="form-input" id="editFonction">
          <option>EQ</option><option>CA1E</option><option>CATE</option><option>CDG</option>
        </select>
      </div>

      <!-- RÃ´les multi-select -->
      <div class="form-group">
        <label class="form-label">RÃ´les</label>
        <div class="role-checkboxes" id="roleCheckboxes"></div>
        <div style="margin-top:10px;font-size:11px;color:var(--text2);text-transform:uppercase;letter-spacing:1px;font-weight:700;margin-bottom:6px">
          AperÃ§u des rÃ´les
        </div>
        <div class="role-preview-wrap" id="rolePreviewWrap">
          <span style="color:var(--text2);font-size:12px">Aucun rÃ´le sÃ©lectionnÃ©</span>
        </div>
      </div>

      <div class="form-group">
        <label class="form-label">Visite mÃ©dicale prÃ©vue</label>
        <input class="form-input" type="date" id="editMedical">
      </div>
      <div class="form-group">
        <label class="form-label">
          Mot de passe
          <span style="color:var(--text2);font-size:10px;text-transform:none;letter-spacing:0;font-weight:400;margin-left:6px">(laisser vide pour ne pas changer)</span>
        </label>
        <input class="form-input" type="password" id="editPassword" placeholder="Nouveau mot de passe">
      </div>

      <div style="display:flex;gap:12px;margin-top:8px">
        <button class="btn-cancel" onclick="closeUserEdit()">Annuler</button>
        <button class="btn-primary" style="flex:1;margin-top:0" onclick="saveUser()">ğŸ’¾ ENREGISTRER</button>
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CONFIRM DELETE
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div class="confirm-delete" id="confirmDelete">
    <div class="confirm-box">
      <div class="confirm-icon">ğŸ—‘ï¸</div>
      <div class="confirm-title">Supprimer ?</div>
      <div class="confirm-sub" id="confirmDeleteName">Cette action est irrÃ©versible.</div>
      <div class="confirm-actions">
        <button class="btn-cancel" onclick="closeConfirmDelete()">Annuler</button>
        <button class="btn-danger" onclick="confirmDeleteUser()">Supprimer</button>
      </div>
    </div>
  </div>

  -->

  <div id="toast" class="toast"></div>

  <script type="module" src="app-firebase.js"></script>
</body>
</html>
